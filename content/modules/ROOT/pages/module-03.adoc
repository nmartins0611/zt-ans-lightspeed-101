= Lab Guide: Deploying PostgreSQL and PGAdmin with Ansible Lightspeed
:doctype: book
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_A guide to using Ansible Lightspeed to generate a playbook that installs `postgresql-server` and creates a PGAdmin Podman container._

---

== Introduction and Setup

[IMPORTANT]
====
**Important Note About This Lab**

IBM watsonx Code Assistant models are continuously updated and improved. As a result, some specific task generation challenges in this lab may not work exactly as described due to model updates. This is expected behavior.

**The primary goal of this lab is to help you understand the key features of Ansible Lightspeed, including:**

* **Playbook Generation** - Generating entire playbooks from natural language prompts
* **Task Generation** - Generating individual tasks or multiple tasks at once
* **Training Matches** - Understanding the transparency of AI suggestions
* **Best Practices** - Learning how Lightspeed incorporates Ansible best practices

**If a specific prompt doesn't generate suggestions as expected:**

* Try **playbook generation** instead of task generation (delete the play structure and generate the entire playbook from a prompt)
* Experiment with different prompt variations to see what gives you the best suggestions
* Simplify complex multi-task prompts into separate single-task prompts
* The learning objectives remain the same: understanding how to work with AI-assisted Ansible development
====

In this challenge, you will use Ansible Lightspeed to generate an Ansible Playbook that automates a complete database and management tool setup.

=== Your Mission

Your goal is to use Ansible Lightspeed to generate a playbook that automates the following tasks:

.   Installs `postgresql-server`, initializes the database, and starts and enables the `postgresql` service.
.   Configures the firewall for `postgresql` traffic.
.   Uses `podman` to configure and run the `dpage/pgadmin4` container.

The examples used in this lab are available in the link:https://github.com/ansible/ansible-lightspeed-demos[Ansible Lightspeed Demo repository].

[NOTE]
====
**Need Help?** If you encounter difficulties or want to verify your work, you can reference the solution playbook at `playbooks/infra/install_pgsql_and_pgadmin/solution_install_pgsql_pgadmin.yml` in the repository.
====

---

== Task 1: Generate Playbook Tasks with Ansible Lightspeed

You will now edit a pre-created playbook file and use natural language prompts to have Ansible Lightspeed generate the necessary tasks.

.   **Open the playbook file in VS Code.**
+
    In the **VS Code** tab, navigate to the file explorer and **open** `playbooks/infra/install_pgsql_and_pgadmin/demo_install_pgsql_pgadmin.yml`.

.   **Generate the PostgreSQL installation task.**
+
    **Uncomment** the first task name by removing the `#` or pressing `CTRL+/`.
+
[source,yaml]
----
# - name: Install postgresql server package
----
+
    **Place** your cursor at the end of the line and press `ENTER`. Ansible Lightspeed will generate a task suggestion. **Press** `TAB` to accept it.
+
    _Lightspeed Highlight:_ The suggestion correctly uses the `ansible.builtin.dnf` module and incorporates best practices.

.   **Generate the multi-task for config, start, and firewall.**
+
    Go to the end of the following multi-task prompt line, press `ENTER`, and then `TAB` to accept the suggestion:
+
[source,yaml]
----
# Do initial postgresql config & start the service & allow the traffic through the firewall
----
+
    _Lightspeed Highlight:_ Lightspeed uses the playbook context to infer the correct service (`postgresql`) and default port (`5432/tcp`) and generates three distinct, idempotent tasks from this single prompt.

.   **Generate the Podman container task.**
+
    **Uncomment** the final task name:
+
[source,yaml]
----
# - name: Create podman container using pgadmin_container var
----
+
    **Place** your cursor at the end of the line, press `ENTER`, and then `TAB` to accept the suggestion.
+
    _Lightspeed Highlight:_ Lightspeed correctly identifies that the `pgadmin_container` variable is defined in the playbook's `vars` section and integrates it into the suggested task.

.   **Save the playbook** by navigating to **File** â†’ **Save** or by pressing `CTRL+S`.

== Task 2: Review Ansible Lightspeed Training Matches

One of Ansible Lightspeed's key differentiators is providing information on the potential training data used to generate suggestions.

.   **Open the Lightspeed Training Matches view.**
+
    In VS Code, open the View menu by clicking **View** â†’ **Open View...**.
+
image:../assets/vscode_view_menu.png[VS Code View menu, opts="border"]
+
    Search for `Lightspeed` and select **Lightspeed Training Matches**.
+
image:../assets/vscode_view_lightpseed.png[Opening the Lightspeed Training Matches view, opts="border"]

.   **Examine a training match.**
+
    Choose any task description in your playbook and regenerate a suggestion. The Training Matches pane will populate with potential sources. **Click** on any entry to see details including the content source, author, and license.
+
image:../assets/vscode_training_match.png[Example of a training match, opts="border"]

== Task 3: Run the Playbook

You can now choose to run the completed playbook using either the automation controller or `ansible-navigator`.

=== Option 1: Using Automation Controller

.   **Commit and push the playbook.**
+
    In VS Code, **click** the **Source Control** icon. **Click** the **+** icon next to the playbook name to stage the changes, enter a commit message (e.g., `Install PostgreSQL`), and **click** the **Commit** button. Finally, **click** **Sync Changes** to push the playbook to the repository.

.   **Run the Job Template.**
+
    Go to the **Ansible Automation Platform** tab. Log in with credentials `admin` / `ansible123!` if prompted. Navigate to **Resources** â†’ **Templates** and **click** the launch icon (ðŸš€) next to the **Deploy PostgreSQL and PG Admin** Job Template.
+
    Wait for the job to complete successfully.

=== Option 2: Using ansible-navigator

.   **Open a terminal in VS Code.**
+
    In the **VS Code** tab, click **Terminal** â†’ **New Terminal**.

.   **Navigate to the correct folder.**
+
[source,bash]
----
cd playbooks/infra/install_pgsql_and_pgadmin
----

.   **Run the playbook.**
+
[source,bash]
----
ansible-navigator run demo_install_pgsql_pgadmin.yml
----
+
Press the `ESC` key to return to the prompt after the playbook completes.

== Task 4: Verify the PGAdmin Installation

Finally, verify that the PGAdmin web interface is accessible.

.   **Open the PGAdmin tab** at the top of the lab window.

.   **Verify PGAdmin is accessible.** If the playbook completed successfully, you should see the PGAdmin login interface.

---

== Conclusion and Additional Resources

Congratulations! You've successfully created an Ansible Playbook using Ansible Lightspeed to deploy PostgreSQL and PGAdmin!

[NOTE]
====
**Solution Playbook Available:** If you encountered issues or want to compare your work, you can review the complete solution at `playbooks/infra/install_pgsql_and_pgadmin/solution_install_pgsql_pgadmin.yml` in the repository.
====

=== Additional Resources

* link:https://www.redhat.com/en/technologies/management/ansible/ansible-lightspeed[More information] on Red Hat Ansible Lightspeed with IBM watsonx Code Assistant
* link:https://docs.redhat.com/en/documentation/red_hat_ansible_lightspeed_with_ibm_watsonx_code_assistant[Ansible Lightspeed Documentation]
* link:https://www.youtube.com/ansibleautomation[Red Hat Ansible Automation Platform YouTube channel]

=== Feedback

Please provide your feedback or report bugs using the **Ansible Lightspeed Feedback** section located in the VS Code Ansible Extension sidebar.
