= Lab Guide: Provisioning an AWS EC2 Instance with Ansible Lightspeed
:doctype: book
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_A guide to using Ansible Lightspeed to generate a playbook that provisions a t3.small EC2 instance on AWS._

---

== Introduction and Setup

[IMPORTANT]
====
**Important Note About This Lab**

IBM watsonx Code Assistant models are continuously updated and improved. As a result, some specific task generation challenges in this lab may not work exactly as described due to model updates. This is expected behavior.

**The primary goal of this lab is to help you understand the key features of Ansible Lightspeed, including:**

* **Playbook Generation** - Generating entire playbooks from natural language prompts
* **Task Generation** - Generating individual tasks or multiple tasks at once
* **Training Matches** - Understanding the transparency of AI suggestions
* **Best Practices** - Learning how Lightspeed incorporates Ansible best practices

**If a specific prompt doesn't generate suggestions as expected:**

* Try **playbook generation** instead of task generation (delete the play structure and generate the entire playbook from a prompt)
* Experiment with different prompt variations to see what gives you the best suggestions
* Simplify complex multi-task prompts into separate single-task prompts
* The learning objectives remain the same: understanding how to work with AI-assisted Ansible development
====

In this challenge, you will use Ansible Lightspeed to generate an Ansible Playbook that automates the provisioning of an Amazon Web Services (AWS) EC2 instance.

=== Your Mission

Your goal is to use Ansible Lightspeed to generate a playbook that automates the following tasks:

.   Gathers information about an existing VPC subnet.
.   Provisions a `t3.small` EC2 instance within that subnet.
.   Waits for the instance to be ready and then prints its public IP address.

The examples used in this lab are available in the link:https://github.com/ansible/ansible-lightspeed-demos[Ansible Lightspeed Demo repository].

[IMPORTANT]
====
The login credentials for all services in this lab are:

* **Username:** `student`
* **Password:** `learn_ansible`
====

=== Copy and Paste Instructions for the RHEL Workstation

The lab uses a VNC browser instance to access the RHEL workstation. Some browsers, like Firefox and Safari, do not support direct copy and paste. The **Chrome** browser is recommended.

If you are not using Chrome, you can use the **VNC Clipboard utility** to copy and paste between your local machine and the lab instance.

.   **Open the VNC Clipboard utility** on the `RHEL` tab by pressing:
    * `CTRL`+`ALT`+`SHIFT` on Windows or Linux.
    * `CTRL`+`OPTION`+`SHIFT` on Mac.
.   **Use the clipboard text area** as an interface between your local and remote clipboards.
+
image:../assets/vnc_sidebar_clipboard.png[VNC sidebar clipboard utility, opts="border"]
.   **Close the utility** by pressing the same key combination again.

---

== Task 1: Generate Playbook Tasks with Ansible Lightspeed

You will now edit a pre-created playbook file and use natural language prompts to have Ansible Lightspeed generate the necessary tasks.

.   **Open the playbook file in VS Code.**
+
    In the `RHEL` tab, open Visual Studio Code. In the VS Code sidebar, navigate to `playbooks/cloud/aws/` and **open** the `demo_provision_ec2_instance.yml` file.
+
image::../assets/demo_provision_ec2_instance-open.png[Opening the demo playbook file, opts="border"]

.   **Generate the subnet info and variable tasks.**
+
    Go to the end of the following multi-task prompt line, press `ENTER`, and then `TAB` to accept the suggestion:
+
[source,yaml]
----
# Gather info from subnet called subnet-lightspeed & create vpc_subnet_id var
----
+
    _Lightspeed Highlight:_ Lightspeed generates two tasks from this single prompt. The first gathers information about the named subnet, and the second uses the `set_fact` module to create a new variable, `vpc_subnet_id`, from the results of the first task.

.   **Generate the EC2 instance provisioning task.**
+
    **Uncomment** the next task name by removing the `#` or pressing `CTRL+/`.
+
[source,yaml]
----
# - name: Provision t3.small instance using my_instance var
----
+
    **Place** your cursor at the end of the line, press `ENTER`, and then `TAB` to accept the suggestion.
+
    _Lightspeed Highlight:_ Lightspeed correctly uses the `amazon.aws.ec2_instance` module. It also incorporates the `my_instance` variable (defined in the playbook's `vars` section) and the `vpc_subnet_id` variable created in the previous step.

.   **Generate the tasks to get and print the public IP.**
+
    Go to the end of the final multi-task prompt line, press `ENTER`, and then `TAB` to accept the suggestion:
+
[source,yaml]
----
# Create var from public_ip_address with retry & print it out
----
+
    _Lightspeed Highlight:_ Lightspeed generates a task to create a new variable for the public IP address, including a `wait_for` condition to ensure the IP is available. It then creates a second task to print the value of that new variable.

.   **Save the playbook** by navigating to **File** â†’ **Save** or by pressing `CTRL+S`.

== Task 2: Review Ansible Lightspeed Training Matches

One of Ansible Lightspeed's key differentiators is providing information on the potential training data used to generate suggestions.

.   **Open the Lightspeed Training Matches view.**
+
    In VS Code, open the View menu by clicking **View** â†’ **Open View...**.
+
image:../assets/vscode_view_menu.png[VS Code View menu, opts="border"]
+
    Search for `Lightspeed` and select **Lightspeed Training Matches**.
+
image:../assets/vscode_view_lightpseed.png[Opening the Lightspeed Training Matches view, opts="border"]

.   **Examine a training match.**
+
    Choose any task description in your playbook and regenerate a suggestion. The Training Matches pane will populate with potential sources. **Click** on any entry to see details including the content source, author, and license.
+
image:../assets/vscode_training_match.png[Example of a training match, opts="border"]

== Task 3: Run the Playbook

You can now choose to run the completed playbook using either the automation controller or `ansible-navigator`.

=== Option 1: Using Automation Controller

.   **Commit and push the playbook.**
+
    In VS Code, **click** the **Source Control** icon. **Click** the **+** icon next to the playbook name to stage the changes, enter a commit message (e.g., `Provision EC2 instance`), and **click** the **Commit** button. Finally, **click** **Sync Changes** to push the playbook to the repository.
+
image::../assets/demo_provision_ec2_instance-commit.png[Committing changes in VS Code, opts="border"]

.   **Run the Job Template.**
+
    Go to the **Controller** tab. Navigate to **Templates** and **click** the launch icon (ðŸš€) next to the **Provision EC2 instance** Job Template.
+
image:../assets/provision_ec2_launch.png[Launching the job template, opts="border"]
+
    Wait for the job to complete successfully.
+
image:../assets/provision_ec2_success.png[Successful job completion, opts="border"]

=== Option 2: Using ansible-navigator

.   **Open a terminal in VS Code.**
+
    Click **Terminal** â†’ **New Terminal**.
+
image:../assets/vscode_open_terminal.png[Opening a new terminal, opts="border"]

.   **Navigate to the correct folder.**
+
[source,bash]
----
cd playbooks/cloud/aws
----

.   **Run the playbook.**
+
[source,bash]
----
ansible-navigator run demo_provision_ec2_instance.yml
----
+
image::../assets/install_ec2_success_navigator.png[Successful run in ansible-navigator, opts="border"]
+
Press the `ESC` key to return to the prompt.

== Task 4: Verify the EC2 Instance Creation

Finally, verify that the new EC2 instance is running in the AWS console.

.   **Navigate to the AWS Console.**
+
    Open the **AWS/Azure Credentials** tab and **click** the **AWS Account ID** link.
+
image:../assets/aws_account.png[AWS account credentials tab, opts="border"]

.   **Log in to AWS.**
+
    **Copy** the username and password from the credentials tab to log in to the AWS console.

.   **Check the EC2 Instances.**
+
    Make sure the region is set to **N. Virginia (us-east-1)**. Navigate to the **EC2** service, then click on **Instances**. You should see the new instance you created, `lightspeed-instance`, in the running state.

---

== Conclusion and Additional Resources

Congratulations! You've successfully created an Ansible Playbook using Ansible Lightspeed to provision an AWS EC2 Instance!

=== Need Help?

* **Solution Videos:** One or more solution videos are available below.
* **How to Skip:** Click the `Skip` button at the bottom right to move to the next challenge.

.Solution Videos
[%collapsible]
====
.Generating the Playbook
video::../assets/ec2_playbook.gif[youtube]

.Commit and Push to Repository
video::../assets/ec2_commit.gif[youtube]

.Run in Automation Controller
video::../assets/ec2_controller_run.gif[youtube]

.Run using ansible-navigator
video::../assets/ec2_navigator_run.gif[youtube]
====

=== Feedback

Please provide your feedback or report bugs using the **Ansible Lightspeed Feedback** section located in the VS Code Ansible Extension sidebar.
image:../assets/extension_feedback.png[Ansible extension feedback section, opts="border"]

=== Additional Resources

* link:https://www.redhat.com/en/technologies/management/ansible/ansible-lightspeed[More information] on Red Hat Ansible Lightspeed with IBM watsonx Code Assistant.
* link:https://www.redhat.com/en/engage/redhat-ansible-automation-202108061218[Self-paced exercises]
* link:http://red.ht/try_ansible[Trial subscription]
* link:https://www.youtube.com/ansibleautomation[Red Hat Ansible Automation Platform YouTube channel]

=== Troubleshooting

If you have encountered an issue, please link:https://github.com/ansible/instruqt/issues/new?labels=lightspeed-101-rh1&title=New+Intro+to+Lightspeed+issue:+monitoring&assignees=craig-br[open an issue on GitHub].
