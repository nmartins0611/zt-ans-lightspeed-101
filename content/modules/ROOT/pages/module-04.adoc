= Lab Guide: Provisioning an AWS EC2 Instance with Ansible Lightspeed
:doctype: book
:notoc:
:toc-title: Table of Contents
:nosectnums:
:icons: font

_A guide to using Ansible Lightspeed to generate a playbook that provisions a t3.small EC2 instance on AWS._

---

== Introduction and Setup

[IMPORTANT]
====
**Important Note About This Lab**

IBM watsonx Code Assistant models are continuously updated and improved. As a result, some specific task generation challenges in this lab may not work exactly as described due to model updates. This is expected behavior.

**The primary goal of this lab is to help you understand the key features of Ansible Lightspeed, including:**

* **Playbook Generation** - Generating entire playbooks from natural language prompts
* **Task Generation** - Generating individual tasks or multiple tasks at once
* **Training Matches** - Understanding the transparency of AI suggestions
* **Best Practices** - Learning how Lightspeed incorporates Ansible best practices

**If a specific prompt doesn't generate suggestions as expected:**

* Try **playbook generation** instead of task generation (delete the play structure and generate the entire playbook from a prompt)
* Experiment with different prompt variations to see what gives you the best suggestions
* Simplify complex multi-task prompts into separate single-task prompts
* The learning objectives remain the same: understanding how to work with AI-assisted Ansible development
====

In this challenge, you will use Ansible Lightspeed to generate an Ansible Playbook that automates the provisioning of an Amazon Web Services (AWS) EC2 instance.

=== Your Mission

Your goal is to use Ansible Lightspeed to generate a playbook that automates the following tasks:

.   Gathers information about an existing VPC subnet.
.   Provisions a `t3.small` EC2 instance within that subnet.
.   Waits for the instance to be ready and then prints its public IP address.

The examples used in this lab are available in the link:https://github.com/ansible/ansible-lightspeed-demos[Ansible Lightspeed Demo repository].

[NOTE]
====
**AWS Credentials:** This lab uses a temporary AWS account. You'll find the credentials in the **AWS/Azure** tab at the top of your lab environment when you need them in Task 4.

**Need Help?** If you encounter difficulties or want to verify your work, you can reference the solution playbook at `playbooks/cloud/aws/solution_provision_ec2_instance.yml` in the repository.
====

---

== Task 1: Generate Playbook Tasks with Ansible Lightspeed

You will now edit a pre-created playbook file and use natural language prompts to have Ansible Lightspeed generate the necessary tasks.

.   **Open the playbook file in VS Code.**
+
    a. Click on the **VS Code** tab at the top of your lab environment
+
    b. On the left side of VS Code, click the **Explorer** icon (two overlapping documents) to show the file explorer
+
    c. In the file explorer, expand these folders: **playbooks** â†’ **cloud** â†’ **aws**
+
    d. Click on **demo_provision_ec2_instance.yml** to open it in the editor

.   **Generate the subnet info and variable tasks.**
+
[IMPORTANT]
====
**Multi-task prompt:** This comment starts with `#` and uses `&` to separate TWO tasks. Do NOT uncomment - just press ENTER at the end.
====
+
    a. Find the line:
+
[source,yaml]
----
    # Gather info from subnet called subnet-lightspeed & create vpc_subnet_id var
----
+
    b. **Do NOT uncomment this line** - leave the `#` symbol in place
+
    c. **Place your cursor at the end of the line** (after "var")
+
    d. **Press `ENTER`** to create a new line
+
    e. **Press `TAB`** when Lightspeed shows suggestions for BOTH tasks
+
    _Lightspeed Highlight:_ Lightspeed generates two tasks from this single prompt. The first gathers information about the named subnet, and the second uses the `set_fact` module to create a new variable, `vpc_subnet_id`, from the results of the first task.

.   **Generate the EC2 instance provisioning task.**
+
    a. Find the commented line:
+
[source,yaml]
----
    #- name: Provision t3.small instance using my_instance var
----
+
    b. **Uncomment the line** by removing the `#` (or press `CTRL+/` for Windows/Linux or `CMD+/` for Mac)
+
    c. **Place your cursor at the end of the line** (after "var")
+
    d. **Press `ENTER`** to create a new line
+
    e. **Press `TAB`** when Lightspeed shows a suggestion
+
    _Lightspeed Highlight:_ Lightspeed correctly uses the `amazon.aws.ec2_instance` module. It also incorporates the `my_instance` variable (defined in the playbook's `vars` section) and the `vpc_subnet_id` variable created in the previous step.

.   **Generate the tasks to get and print the public IP.**
+
[IMPORTANT]
====
**Multi-task prompt:** This will generate TWO tasks - one to get the IP and one to print it.
====
+
    a. Find the line:
+
[source,yaml]
----
    # Create var from public_ip_address with retry & print it out
----
+
    b. **Do NOT uncomment this line** - leave the `#` symbol in place
+
    c. **Place your cursor at the end of the line** (after "out")
+
    d. **Press `ENTER`** to create a new line
+
    e. **Press `TAB`** when Lightspeed shows suggestions for BOTH tasks
+
    _Lightspeed Highlight:_ Lightspeed generates a task to create a new variable for the public IP address, including a `wait_for` condition to ensure the IP is available. It then creates a second task to print the value of that new variable.

.   **Save the playbook.**
+
    Click **File** â†’ **Save** from the top menu, or press `CTRL+S` (Windows/Linux) or `CMD+S` (Mac).

== Task 2: Review Ansible Lightspeed Training Matches

One of Ansible Lightspeed's key differentiators is providing information on the potential training data used to generate suggestions.

.   **Open the Lightspeed Training Matches view.**
+
    a. At the top of VS Code, click **View** in the menu bar
+
    b. Select **Open View...**
+
    c. In the search box that appears, type `Lightspeed`
+
    d. Click on **Lightspeed Training Matches** from the list

.   **Examine a training match.**
+
    a. In your playbook, click on any task name you generated
+
    b. Delete one line of the generated code and press `ENTER` to regenerate the suggestion
+
    c. Look at the **Lightspeed Training Matches** pane (usually at the bottom of VS Code)
+
    d. You'll see potential training sources. **Click** on any entry to see details including the content source, author, and license information.

== Task 3: Run the Playbook

You can now choose to run the completed playbook using either the automation controller or `ansible-navigator`.

=== Option 1: Using Automation Controller

.   **Commit and push the playbook to Git.**
+
    a. On the left side of VS Code, click the **Source Control** icon (it looks like a branch with circles)
+
    b. You should see `demo_provision_ec2_instance.yml` listed under "Changes"
+
    c. Hover over the file name and click the **+** (plus) icon that appears to stage the changes
+
    d. At the top, in the "Message" box, type a commit message like: `Provision EC2 instance`
+
    e. Click the **Commit** button (checkmark icon)
+
    f. Click the **Sync Changes** button to push your playbook to the Git repository

.   **Run the playbook from Automation Controller.**
+
    a. Click the **Ansible Automation Platform** tab at the top of the lab window
+
    b. If you see a login screen, enter:
       * **Username:** `admin`
       * **Password:** `ansible123!`
+
    c. On the left sidebar, click **Resources** â†’ **Templates**
+
    d. Find the template named **Provision EC2 instance**
+
    e. Click the **launch icon** (ðŸš€ rocket ship) on the right side of that row
+
    f. Wait for the job to complete successfully (you'll see a green "Successful" status)

=== Option 2: Using ansible-navigator

.   **Open a terminal in VS Code.**
+
    a. Make sure you're on the **VS Code** tab
+
    b. Look at the top menu bar and click **Terminal** â†’ **New Terminal**
+
    c. A terminal panel will open at the bottom of VS Code

.   **Navigate to the playbook folder.**
+
    In the terminal, type the following command and press `ENTER`:
+
[source,bash]
----
cd playbooks/cloud/aws
----

.   **Run the playbook with ansible-navigator.**
+
    Type the following command and press `ENTER`:
+
[source,bash]
----
ansible-navigator run demo_provision_ec2_instance.yml
----
+
    The playbook will run and show you the results. Press the `ESC` key to return to the terminal prompt when it's done.

== Task 4: Verify the EC2 Instance Creation

Finally, verify that the new EC2 instance is running in the AWS console.

.   **Get your AWS credentials and access the console.**
+
    a. At the very top of your lab environment, click the **AWS/Azure** tab
+
    b. You'll see AWS account credentials displayed (Account ID, Username, Password, and Console URL)
+
    c. Click the **AWS Console URL** link (or copy it to a new browser tab)

.   **Log in to the AWS Console.**
+
    a. Go back to the **AWS/Azure** tab to copy the credentials
+
    b. Copy the **Username** and **Password** shown
+
    c. Paste them into the AWS login page
+
    d. Click **Sign In**

.   **View your EC2 instance.**
+
    a. At the top of the AWS Console, make sure the region is set to **N. Virginia (us-east-1)**
+
    b. In the search bar at the top, type `EC2` and click on **EC2** service
+
    c. On the left sidebar, click **Instances** (under "Instances")
+
    d. You should see your new instance named **lightspeed-instance** with a status of "Running"
+
    e. This confirms that your Ansible playbook successfully created the EC2 instance!

---

== Conclusion and Additional Resources

Congratulations! You've successfully created an Ansible Playbook using Ansible Lightspeed to provision an AWS EC2 Instance!

[NOTE]
====
**Solution Playbook Available:** If you encountered issues or want to compare your work, you can review the complete solution at `playbooks/cloud/aws/solution_provision_ec2_instance.yml` in the repository.
====

=== Additional Resources

* link:https://www.redhat.com/en/technologies/management/ansible/ansible-lightspeed[More information] on Red Hat Ansible Lightspeed with IBM watsonx Code Assistant
* link:https://docs.redhat.com/en/documentation/red_hat_ansible_lightspeed_with_ibm_watsonx_code_assistant[Ansible Lightspeed Documentation]
* link:https://docs.aws.amazon.com/ec2/[AWS EC2 Documentation]
* link:https://www.youtube.com/ansibleautomation[Red Hat Ansible Automation Platform YouTube channel]

=== Feedback

Please provide your feedback or report bugs using the **Ansible Lightspeed Feedback** section located in the VS Code Ansible Extension sidebar.
